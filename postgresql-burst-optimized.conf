# PostgreSQL Configuration Optimized for Massive Burst Transactions
# This configuration is optimized for high-concurrency casino gaming workloads

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# Network Configuration
listen_addresses = '*'                   # Listen on all interfaces for Docker networking
port = 5432                              # Default PostgreSQL port

# Maximum number of concurrent connections
max_connections = 1000                   # Enterprise-level for millions of users

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

# Memory Configuration
shared_buffers = 2GB                     # Enterprise-level (25% of available RAM)
work_mem = 32MB                          # Enterprise-level for complex queries
maintenance_work_mem = 256MB             # Enterprise-level for maintenance operations
autovacuum_work_mem = 128MB              # Enterprise-level for autovacuum operations

# Disk Configuration
effective_io_concurrency = 8             # Enterprise-level for better I/O parallelism
random_page_cost = 1.1                   # Optimized for SSD
effective_cache_size = 16GB              # Enterprise-level (75% of available RAM)

#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

# WAL Configuration for Enterprise Throughput
wal_buffers = 64MB                       # Enterprise-level for better WAL performance
wal_writer_delay = 100ms                 # Enterprise-level for faster WAL writes
commit_delay = 2000                      # Enterprise-level for batch commits
commit_siblings = 5                      # Enterprise-level for faster commits

# Checkpoint Configuration
checkpoint_completion_target = 0.9       # Keep high for smooth checkpoints
checkpoint_timeout = 30min               # Enterprise-level for fewer checkpoints
max_wal_size = 8GB                       # Enterprise-level for fewer checkpoints
min_wal_size = 256MB                     # Enterprise-level for better performance

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

# Query Planning
default_statistics_target = 1000         # Enterprise-level for better query plans
constraint_exclusion = partition          # Enable constraint exclusion
cursor_tuple_fraction = 0.1              # Optimize for cursor queries

#------------------------------------------------------------------------------
# ERROR REPORTING AND LOGGING
#------------------------------------------------------------------------------

# Logging Configuration
log_destination = 'stderr'               # Log to stderr for Docker
logging_collector = off                  # Disable file logging in Docker
log_min_duration_statement = 1000        # Log queries taking more than 1 second
log_checkpoints = on                     # Log checkpoints for monitoring
log_connections = off                    # Disable connection logging for performance
log_disconnections = off                 # Disable disconnection logging
log_lock_waits = on                      # Enable lock wait logging for debugging
log_temp_files = 0                       # Log all temporary files
log_autovacuum_min_duration = 0          # Log all autovacuum operations

#------------------------------------------------------------------------------
# RUNTIME STATISTICS
#------------------------------------------------------------------------------

# Statistics Configuration
track_activities = on                    # Track query activities
track_counts = on                        # Track table and index usage
track_io_timing = on                     # Track I/O timing
track_functions = all                    # Track function calls

#------------------------------------------------------------------------------
# AUTOVACUUM PARAMETERS
#------------------------------------------------------------------------------

# Autovacuum Configuration for Enterprise Workloads
autovacuum = on                          # Enable autovacuum
autovacuum_max_workers = 10              # Enterprise-level for more workers
autovacuum_naptime = 15s                 # Enterprise-level for faster response
autovacuum_vacuum_threshold = 20         # Enterprise-level for more frequent vacuums
autovacuum_analyze_threshold = 20        # Enterprise-level for more frequent analyzes
autovacuum_vacuum_scale_factor = 0.05    # Enterprise-level for more aggressive vacuum
autovacuum_analyze_scale_factor = 0.02   # Enterprise-level for more frequent analyzes
autovacuum_vacuum_cost_delay = 0ms       # Enterprise-level for faster vacuum
autovacuum_vacuum_cost_limit = 4000      # Enterprise-level for faster vacuum

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

# Statement Behavior
statement_timeout = 60s                  # Enterprise-level statement timeout
lock_timeout = 30s                       # Enterprise-level lock timeout
idle_in_transaction_session_timeout = 300s # Enterprise-level idle transaction timeout
deadlock_timeout = 5s                    # Enterprise-level deadlock detection

#------------------------------------------------------------------------------
# LOCK MANAGEMENT
#------------------------------------------------------------------------------

# Lock Configuration
max_locks_per_transaction = 512          # Enterprise-level for complex transactions
max_pred_locks_per_transaction = 128     # Enterprise-level for complex queries
max_pred_locks_per_relation = -2         # Unlimited predicate locks per relation
max_pred_locks_per_page = 4              # Enterprise-level predicate locks per page

#------------------------------------------------------------------------------
# VERSION/PLATFORM COMPATIBILITY
#------------------------------------------------------------------------------

# Compatibility
array_nulls = on                         # Enable array nulls
backslash_quote = safe_encoding          # Safe backslash quoting
default_with_oids = off                  # Disable OIDs by default
escape_string_warning = on               # Warn about escape sequences
lo_compat_privileges = off               # Disable large object compatibility
quote_all_identifiers = off              # Don't quote all identifiers
standard_conforming_strings = on         # Enable standard conforming strings
synchronize_seqscans = on                # Synchronize sequential scans

#------------------------------------------------------------------------------
# ERROR HANDLING
#------------------------------------------------------------------------------

# Error Handling
exit_on_error = off                      # Don't exit on error
restart_after_crash = on                 # Restart after crash
data_sync_retry = on                     # Retry data sync on failure

#------------------------------------------------------------------------------
# CUSTOMIZED OPTIONS
#------------------------------------------------------------------------------

# Custom settings for burst handling
synchronous_commit = off                 # Disable synchronous commit for better performance
wal_sync_method = fdatasync              # Use fdatasync for WAL sync
full_page_writes = on                    # Enable full page writes for crash recovery
wal_log_hints = off                      # Disable WAL hints for performance
wal_compression = on                     # Enable WAL compression
wal_init_zero = on                       # Initialize WAL files with zeros
wal_recycle = on                         # Recycle WAL files 